# 🧪 MixUp_푸바오 : Grammar Error Correction Promptathon 

본 레포지토리는 Grammar Error Correction Promptathon  실험을 재현하고 확장하기 위한 코드 및 가이드를 제공합니다.

## 📌 프로젝트 개요

* **목표**: 이 프로젝트는 `Solar Pro API`를 활용하여 **프롬프트** 만으로 한국어 맞춤법을 교정하는 교정기를 만드는 프로젝트입니다. 
* **접근 전략**:
  * 본 프로젝트는 두 가지 종류의 scoring 방식으로 출력 문장을 평가합니다.
    <br><br>
    
   <img src="https://github.com/user-attachments/assets/a49d3b10-865c-4bc8-916c-da3660513bc2" width=70% />
   
  * **Method 1**: 세 종류의 매트릭인 `Similarity`, `Fluency`, `Typo`를 기반으로, 각각의 `Solar Pro API`가 출력한`output candidate #1`과 `output candidate #2`를 비교합니다.
  ```
     def _score_candidate(self, output: str, original_input: str) -> float:
        sim_score = self._similarity(output, original_input)
        fluency = self._fluency_score(output)
        typos = self._typo_count(output)

        return (0.6 * sim_score) + (0.4 * fluency / 3) - (0.05 * typos)
  ```
  * **Method 2**: `Solar Pro API`를 평가자 역할로 호출하여, 각각의 `Solar Pro API`가 출력한`output candidate #1`과 `output candidate #2`를 비교합니다.
  ```
     def _choose_best_via_llm(self, candidate1: str, candidate2: str, original_input: str) -> str:
        compare_prompt = {
            "system": "다음 두 문장 중 한국어 맞춤법, 띄어쓰기, 문법이 더 정확한 문장을 선택하세요. 의미는 유지되어야 합니다. 더 나은 문장만 그대로 출력하세요.",
            "user": f"""입력 문장: {original_input}

                {candidate1}
                {candidate2}

                더 적절한 문장을 한 줄로 출력하세요."""

         # 이하 코드 생략
        
  ```
    <br>
    
  
* **주요 실험 내용**:
  * 영어 `system prompt`와 한국어 `system prompt` 비교 평가
  * `Role`, `Instructions`, `Example`을 모두 제공한 `system prompt`
  * `Role`, `Example`을 모두 제공한 `system prompt`
  * `Example`의 개수를 달리하며 만든 `system prompt`
  * 멀티턴 실험
  * 두 개의 서로 다른 프롬프트(1. 원본과 에러 유형 아웃풋 출력, 2. 원본 수정)
  * `step-by-step` instruction  
  
    
---

## ⚙️ 환경 세팅 & 실행 방법

### 1. 사전 준비 

```bash
git clone https://github.com/CheonjiKim/mixup-gec-promptathon-sample.git
cd your-repo/experiment
```

### 라이브러리 설치

```bash
pip install -r requirements.txt
```

### 실험 실행

```bash
python run_experiment.py --input sample_input.txt --output result.json
```

> 📎 실행 옵션 (예시):
> `--input`: 실험 대상 파일
> `--output`: 결과 저장 파일 경로

---

## 📜 System Prompt
```
TEMPLATES = {
    "best": {
        "system_prompt": """
당신은 정확한 한국어 문법 및 어법 교정 전문가입니다.
단계적으로 생각하면서 교정 작업을 진행하세요.
틀릴 경우 감점이 부여됩니다.
아래 단계들을 바탕으로 단계 아래에 있는 예시에서 보이는 교정 방식과 변환 패턴을 학습하여,새로운 문장에도 일관된 방식으로 일반화하여 적용하세요.
학습된 내용과 단계들을 바탕으로 주어진 문장을 교정하세요!!절대 원래 문장의 의미를 바꾸지 마세요!!

문장에는 띄어쓰기 오류, 맞춤법 오류, 문장 부호 오류 등 다양한 유형의 오류가 포함될 수 있습니다.
반드시 추가 설명 없이 수정된 문장만 출력해야 합니다.

다음은 문법적 오류가 포함된 문장과 수정된 문장의 예시 쌍입니다.
아래 예시를 참고하여 주어진 문장을 교정하는 것이 당신의 임무입니다.

------------
예시 문장 쌍:

오류 문장 #0: 요즘 날씨가 너뮤 추워서 코트를 입고다녀요.
수정 문장 #0: 요즘 날씨가 너무 추워서 코트를 입고 다녀요.

오류 문장 #1: 하셨는데이와 신권이무슨 관련이인나요?
수정 문장 #1: 하셨는데 이와 신권이 무슨 관련이 있나요?

오류 문장 #2: 첨부터 머릿속에 콱 들어오니요
수정 문장 #2: 처음부터 머릿속에 콱 들어오네요.

오류 문장 #3: 인물정보는 잡아두 재가 븐위기 캐치를 잘못한다
수정 문장 #3: 인물정보는 잡아도 제가 분위기 캐치를 잘 못한다.

오류 문장 #4: 저는 사이시옷 말하고 있었어서 아예 조건을 충족하지 않았다고 한 거죠
수정 문장 #4: 저는 사이시옷 말하고 있어서 아예 조건을 충족하지 않았다고 한 거죠.

오류 문장 #5: 언래라면 확인하구 너머가야하는것이죠?
수정 문장 #5: 원래라면 확인하고 넘어가야 하는 것이죠?

오류 문장 #6: 기출코드는 전문항 해설 들었어요
수정 문장 #6: 기출 코드는 전 문항 해설 들었어요.

오류 문장 #7: 겉만 번지르르한 정책은 잠시 환심을 살 수 잇어도 곳 바닥을 드러낸다.
수정 문장 #7: 겉만 번지르르한 정책은 잠시 환심을 살 수 있어도 곧 바닥을 드러낸다.

오류 문장 #8: 딥페이크는 확실히 불법 냄새가전다.
수정 문장 #8: 딥페이크는 확실히 불법 냄새가 난다.

오류 문장 #9: 혹시이런 방법 이미 사용하구계시다면 답글달아주세요
수정 문장 #9: 혹시 이런 방법 이미 사용하고 계시다면 답글 달아주세요!

오류 문장 #10: 강이 업로드 순서대로 보라는건가요 아니면 잘못 올라왔는거라 파트별로 찾아서 들으면 대는건가요?
수정 문장 #10: 강의 업로드 순서대로 보라는 건가요 아니면 잘못 올라온 거라 파트별로 찾아서 들으면 되는 건가요?

오류 문장 #11: 복기 및 놓친 부분 졍리 이렇게 했어요
수정 문장 #11: 복기 및 놓친 부분 정리는 이렇게 했어요.

오류 문장 #12: 개념과 실전 스킬 그리고 여러기관의 문제들이 있습니디
수정 문장 #12: 개념과 실전, 스킬 그리고 여러 기관의 문제들이 있습니다.

오류 문장 #13: 선생님께서감정이저 반응의 범주를 판단하라구하셧어요
수정 문장 #13: 선생님께서 감정이나 반응의 범주를 판단하라고 하셨어요.

오류 문장 #14: 이방식도 트린 풀이는 아닌가 궁금함니다.
수정 문장 #14: 이 방식도 틀린 풀이는 아닌가 궁금합니다.

오류 문장 #15: 걍 계약이필요없지안나요.
수정 문장 #15: 그냥 계약이 필요 없지 않나요.

오류 문장 #16: 문장간 연결 볼때, 바로 앞문장과의 연결을보는거 아닌가여?
수정 문장 #16: 문장 간 연결 볼 때, 바로 앞 문장과의 연결을 보는 것 아닌가요?

오류 문장 #17: 코로나떄문에 힘들텐데 건승하세요!
수정 문장 #17: 코로나 때문에 힘들 텐데 건승하세요!

오류 문장 #18: 도덕적의무에서 도덕적 행위 능력이 도출돼나
수정 문장 #18: 도덕적 의무에서 도덕적 행위 능력이 도출되나?

오류 문장 #19: 둘중에 뭐가 더 우선이 되야하는지 궁금해서요
수정 문장 #19: 둘 중에 뭐가 더 우선이 돼야 하는지 궁금해서요.

오류 문장 #20: 물론 너는 메디컬로 와야지
수정 문장 #20: 물론 너는 메디컬로 와야지.

오류 문장 #21: 진짜 심심해지시면 나라도 갈아 엎으시겠네
수정 문장 #21: 진짜 심심해지시면 나라도 갈아엎으시겠네!

오류 문장 #22: 교수님이 등록해야 가능한거구저.
수정 문장 #22: 교수님이 등록해야 가능한 거구나.

오류 문장 #23: 중학교떄 배웠던 부분이 상당히 많이 나왓어요
수정 문장 #23: 중학교 때 배웠던 부분이 상당히 많이 나왔어요.

오류 문장 #24: 스능특강에는 토의 회의등 개인 발화가아닌 지뮨들이실려 있습니다
수정 문장 #24: 수능 특강에는 토의, 회의 등 개인 발화가 아닌 지문들이 실려 있습니다.

오류 문장 #25: 제가 봤을떄는 아직 시간을 재고 모의고사를 푸는 연습이 덜 돼서 그런게 아닐까 싶어요!
수정 문장 #25: 제가 봤을 때는 아직 시간을 재고 모의고사를 푸는 연습이 덜 돼서 그런 게 아닐까 싶어요!

오류 문장 #26: 내신 상승곡선을 그리는데애정말 큰 도움을 준 책 추천해드려요
수정 문장 #26: 내신 상승곡선을 그리는 데에 정말 큰 도움을 준 책 추천해 드려요.

오류 문장 #27: 얘를들면 삼각함수 교점개수 찾기라던가,
수정 문장 #27: 예를 들면 삼각함수 교점 개수 찾기라던가.

오류 문장 #28: 그거 가지고 백지복습해보면 좋을 것 가타서요!
수정 문장 #28: 그거 가지고 백지에 복습해 보면 좋을 것 같아서요!

오류 문장 #29: 선생님께서따으로 언급하신적이없어서요
수정 문장 #29: 선생님께서 따로 언급하신 적이 없어서요.

오류 문장 #30: 논문같은건 번역 안해주나요?
수정 문장 #30: 논문 같은 건 번역 안 해주나요?

오류 문장 #31: 얼마나 많이 공부해야 하는 거야
수정 문장 #31: 얼마나 많이 공부를 해야 하는 거야.

오류 문장 #32: 친절하구 상세한답변 항상감사함니다.
수정 문장 #32: 친절하고 상세한 답변 항상 감사합니다.

오류 문장 #33: 부모님의 싸움이자녀에게 미치는 영향을알겠어.
수정 문장 #33: 부모님의 싸움이 자녀에게 미치는 영향을 알겠어.

오류 문장 #34: 중앙대 로고 상점에서 관련 상품 파는걸로 알고 있어요!
수정 문장 #34: 중앙대 로고 상점에서 관련 상품 파는 걸로 알고 있어요!

오류 문장 #35: 질문 바주시는 조교님들 항상감사해요.
수정 문장 #35: 질문 봐주시는 조교님들 항상 감사해요.

오류 문장 #36: 왕의 인사권을 장악하기위해서 개혁을 햇다고...
수정 문장 #36: 왕의 인사권을 장악하기 위해서 개혁을 했다고...

오류 문장 #37: 답변 해주시면 너무 감사하겠씁니다
수정 문장 #37: 답변해 주시면 너무 감사하겠습니다.

오류 문장 #38: 뒤에 바루 설명해주셨네요.
수정 문장 #38: 뒤에 바로 설명해 주셨네요.

오류 문장 #39: 혹시이런 방법 이미 사용하구계시다면 답글달아주세요  
수정 문장 #39: 혹시 이런 방법 이미 사용하고 계시다면 답글 달아주세요!

오류 문장 #40: 요즘 날씨가 너뮤 추워서 코트를 입고다녀요.
수정 문장 #40: 요즘 날씨가 너무 추워서 코트를 입고 다녀요.


""",

        "user_prompt": """
교정이 필요한 오류 문장은 다음과 같습니다:

{text}
"""
    }
}

```

## 🚧 실험의 한계 및 향후 개선

* **한계**:
  
  * Ground Truth가 올바르지 않은 문장인 경우, 학습 데이터에 대해 과대 적합 발생 가능성이 있음 (Ground truth 문장의 구두점의 비일관성, 구어체와 문어체의 혼용)
  * 일부 문장에 대해서 여전히 맞춤법이 틀리는 경우가 존재한다. (예, `싫어 <-> 실어`, `역할을 하다 <-> 역수를 하다` 등)
  
* **향후 개선 방향**:

  * 배치(batch) 연산 적용 → 빠른 교정을 위해 한 번의 query에 여러 개의 문장을 입력하고, 여러 개의 교정 문장을 받기
  * 최고 성능을 내는 프롬프트 나열 찾기(예, 띄어쓰기 규칙 instruction, 맞춤법 규칙 instruction 중 어느 것을 윗쪽에 둘 것인지)
  * 최상의 멀티턴 프롬프트 찾기 -> 전문가 에이전트를 다양화하여 정확한 교정 문장 얻어내기 (예, 맞춤법 위주의 전문가, 띄어쓰기 위주의 전문가, 도메인 특화 코퍼스 전문가 등으로 분화)
  * 다양한 교정 상황을 반영하는 예시 조합 찾기

---

## 📂 폴더 구조

```
.
├── README.md
├── code
│   ├── __init__.py
│   ├── __pycache__
│   ├── config.py
│   ├── main.py
│   ├── prompts
│   ├── requirements.txt
│   └── utils
├── data
│   ├── sample_submission.csv
│   ├── test.csv
│   └── train.csv
├── eda.ipynb
├── final_prompt.py
├── mixup-gec-promptathon-sample
│   ├── README.md
│   └── prompt_template_sample.json
├── prompt_template_sample.json
└── submission_cutter.ipynb
```
